(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})(function(a){function p(a,e,b){var c;return c=a.getWrapperElement().appendChild(document.createElement("div")),c.className=b?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof e?c.innerHTML=e:c.appendChild(e),c}function u(a,e){a.state.currentNotificationClose&&a.state.currentNotificationClose();
a.state.currentNotificationClose=e}a.defineExtension("openDialog",function(f,e,b){function c(a){if("string"==typeof a)d.value=a;else if(!l&&(l=!0,m.parentNode.removeChild(m),n.focus(),b.onClose))b.onClose(m)}var d;b||(b={});u(this,null);var m=p(this,f,b.bottom),l=!1,n=this;if(d=m.getElementsByTagName("input")[0],d){if(d.focus(),b.value&&(d.value=b.value,!1!==b.selectValueOnOpen&&d.select()),b.onInput)a.on(d,"input",function(a){b.onInput(a,d.value,c)});if(b.onKeyUp)a.on(d,"keyup",function(a){b.onKeyUp(a,
d.value,c)});a.on(d,"keydown",function(f){b&&b.onKeyDown&&b.onKeyDown(f,d.value,c)||((27==f.keyCode||!1!==b.closeOnEnter&&13==f.keyCode)&&(d.blur(),a.e_stop(f),c()),13==f.keyCode&&e(d.value,f))});if(!1!==b.closeOnBlur)a.on(d,"blur",c)}else if(f=m.getElementsByTagName("button")[0]){a.on(f,"click",function(){c();n.focus()});if(!1!==b.closeOnBlur)a.on(f,"blur",c);f.focus()}return c});a.defineExtension("openConfirm",function(f,e,b){function c(){l||(l=!0,m.parentNode.removeChild(m),n.focus())}var d;u(this,
null);var m=p(this,f,b&&b.bottom);b=m.getElementsByTagName("button");var l=!1,n=this,q=1;b[0].focus();for(f=0;f<b.length;++f)d=b[f],function(b){a.on(d,"click",function(e){a.e_preventDefault(e);c();b&&b(n)})}(e[f]),a.on(d,"blur",function(){--q;setTimeout(function(){0>=q&&c()},200)}),a.on(d,"focus",function(){++q})});a.defineExtension("openNotification",function(f,e){function b(){d||(d=!0,clearTimeout(m),c.parentNode.removeChild(c))}u(this,b);var c=p(this,f,e&&e.bottom),d=!1,m,l=e&&"undefined"!=typeof e.duration?
e.duration:5E3;a.on(c,"click",function(e){a.e_preventDefault(e);b()});return l&&(m=setTimeout(b,l)),b})});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],a):a(CodeMirror)})(function(a){function p(h,b){return"string"==typeof h?h=new RegExp(h.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$\x26"),b?"gi":"g"):h.global||(h=new RegExp(h.source,h.ignoreCase?"gi":"g")),{token:function(b){h.lastIndex=
b.pos;var a=h.exec(b.string);if(a&&a.index==b.pos)return b.pos+=a[0].length||1,"searching";a?b.pos=a.index:b.skipToEnd()}}}function u(){this.overlay=this.posFrom=this.posTo=this.lastQuery=this.query=null}function f(h){return h.state.search||(h.state.search=new u)}function e(h){return"string"==typeof h&&h==h.toLowerCase()}function b(h,b,a){return h.getSearchCursor(b,a,e(b))}function c(h,b,a,e){h.openDialog(b,e,{value:a,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){g(h)}})}function d(h,b,
a,e,c){h.openDialog?h.openDialog(b,c,{value:e,selectValueOnOpen:!0}):c(prompt(a,e))}function m(h,b,a,e){h.openConfirm?h.openConfirm(b,e):confirm(a)&&e[0]()}function l(h){return h.replace(/\\(.)/g,function(h,b){return"n"==b?"\n":"r"==b?"\r":b})}function n(h){var b=h.match(/^\/(.*)\/([a-z]*)$/);if(b)try{h=new RegExp(b[1],-1==b[2].indexOf("i")?"":"i")}catch(a){}else h=l(h);return("string"==typeof h?""==h:h.test(""))&&(h=/x^/),h}function q(b,a,c){a.queryText=c;a.query=n(c);b.removeOverlay(a.overlay,e(a.query));
a.overlay=p(a.query,e(a.query));b.addOverlay(a.overlay);b.showMatchesOnScrollbar&&(a.annotate&&(a.annotate.clear(),a.annotate=null),a.annotate=b.showMatchesOnScrollbar(a.query,e(a.query)))}function w(b,e,k){var g=f(b),x,l;if(g.query)return v(b,e);x=b.getSelection()||g.lastQuery;k&&b.openDialog?(l=null,c(b,y,x,function(e,c){(a.e_stop(c),e)&&(e!=g.queryText&&(q(b,g,e),g.posFrom=g.posTo=b.getCursor()),l&&(l.style.opacity=1),v(b,c.shiftKey,function(a,e){var c;3>e.line&&document.querySelector&&(c=b.display.wrapper.querySelector(".CodeMirror-dialog"))&&
c.getBoundingClientRect().bottom-4>b.cursorCoords(e,"window").top&&((l=c).style.opacity=.4)}))})):d(b,y,"Search for:",x,function(a){a&&!g.query&&b.operation(function(){q(b,g,a);g.posFrom=g.posTo=b.getCursor();v(b,e)})})}function v(h,e,c){h.operation(function(){var d=f(h),g=b(h,d.query,e?d.posFrom:d.posTo);(g.find(e)||(g=b(h,d.query,e?a.Pos(h.lastLine()):a.Pos(h.firstLine(),0)),g.find(e)))&&(h.setSelection(g.from(),g.to()),h.scrollIntoView({from:g.from(),to:g.to()},20),d.posFrom=g.from(),d.posTo=g.to(),
c&&c(g.from(),g.to()))})}function g(b){b.operation(function(){var a=f(b);(a.lastQuery=a.query,a.query)&&(a.query=a.queryText=null,b.removeOverlay(a.overlay),a.annotate&&(a.annotate.clear(),a.annotate=null))})}function z(a,e,c){a.operation(function(){for(var d,g=b(a,e);g.findNext();)"string"!=typeof e?(d=a.getRange(g.from(),g.to()).match(e),g.replace(c.replace(/\$(\d)/g,function(b,a){return d[a]}))):g.replace(c)})}function k(a,e){if(!a.getOption("readOnly")){var c=a.getSelection()||f(a).lastQuery,
k=e?"Replace all:":"Replace:";d(a,k+r,k,c,function(c){c&&(c=n(c),d(a,t,"Replace with:","",function(d){if(d=l(d),e)z(a,c,d);else{g(a);var f=b(a,c,a.getCursor("from")),k=function(){var e=f.from(),g;!(g=f.findNext())&&(f=b(a,c),!(g=f.findNext())||e&&f.from().line==e.line&&f.from().ch==e.ch)||(a.setSelection(f.from(),f.to()),a.scrollIntoView({from:f.from(),to:f.to()}),m(a,A,"Replace?",[function(){v(g)},k,function(){z(a,c,d)}]))},v=function(b){f.replace("string"==typeof c?d:d.replace(/\$(\d)/g,function(a,
e){return b[e]}));k()};k()}}))})}}var y='Search: \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',r=' \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e \x3cspan style\x3d"color: #888" class\x3d"CodeMirror-search-hint"\x3e(Use /re/ syntax for regexp search)\x3c/span\x3e',t='With: \x3cinput type\x3d"text" style\x3d"width: 10em" class\x3d"CodeMirror-search-field"/\x3e',
A="Replace? \x3cbutton\x3eYes\x3c/button\x3e \x3cbutton\x3eNo\x3c/button\x3e \x3cbutton\x3eAll\x3c/button\x3e \x3cbutton\x3eStop\x3c/button\x3e";a.commands.find=function(b){g(b);w(b)};a.commands.findPersistent=function(b){g(b);w(b,!1,!0)};a.commands.findNext=w;a.commands.findPrev=function(b){w(b,!0)};a.commands.clearSearch=g;a.commands.replace=k;a.commands.replaceAll=function(b){k(b,!0)}});
(function(a){"object"==typeof exports&&"object"==typeof module?a(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],a):a(CodeMirror)})(function(a){function p(a,b,c,d){var m,l,n,q;this.atOccurrence=!1;this.doc=a;null==d&&"string"==typeof b&&(d=!1);c=c?a.clipPos(c):f(0,0);this.pos={from:c,to:c};"string"!=typeof b?(b.global||(b=new RegExp(b.source,b.ignoreCase?"ig":"g")),this.matches=function(c,d){var g,l,k,m,n;if(c){b.lastIndex=0;g=a.getLine(d.line).slice(0,
d.ch);for(l=0;(b.lastIndex=l,n=b.exec(g),n)&&(k=n,m=k.index,l=k.index+(k[0].length||1),l!=g.length););(l=k&&k[0].length||0)||(0==m&&0==g.length?k=void 0:m!=a.getLine(d.line).length&&l++)}else b.lastIndex=d.ch,g=a.getLine(d.line),l=(k=b.exec(g))&&k[0].length||0,m=k&&k.index,m+l==g.length||l||(l=1);if(k&&l)return{from:f(d.line,m),to:f(d.line,m+l),match:k}}):(m=b,d&&(b=b.toLowerCase()),l=d?function(b){return b.toLowerCase()}:function(b){return b},n=b.split("\n"),1==n.length?this.matches=b.length?function(c,
d){if(c){var g=a.getLine(d.line).slice(0,d.ch),n=l(g),k=n.lastIndexOf(b);if(-1<k)return k=u(g,n,k),{from:f(d.line,k),to:f(d.line,k+m.length)}}else if(g=a.getLine(d.line).slice(d.ch),n=l(g),k=n.indexOf(b),-1<k)return k=u(g,n,k)+d.ch,{from:f(d.line,k),to:f(d.line,k+m.length)}}:function(){}:(q=m.split("\n"),this.matches=function(b,c){var d=n.length-1,m,k,p,r,t;if(b){if(c.line-(n.length-1)<a.firstLine()||l(a.getLine(c.line).slice(0,q[d].length))!=n[n.length-1])return;m=f(c.line,q[d].length);r=c.line-
1;for(t=d-1;1<=t;--t,--r)if(n[t]!=l(a.getLine(r)))return;return(k=a.getLine(r),p=k.length-q[0].length,l(k.slice(p))!=n[0])?void 0:{from:f(r,p),to:m}}if(!(c.line+(n.length-1)>a.lastLine())&&(k=a.getLine(c.line),p=k.length-q[0].length,l(k.slice(p))==n[0])){m=f(c.line,p);r=c.line+1;for(t=1;t<d;++t,++r)if(n[t]!=l(a.getLine(r)))return;if(l(a.getLine(r).slice(0,q[d].length))==n[d])return{from:m,to:f(r,q[d].length)}}}))}function u(a,b,c){var d;if(a.length==b.length)return c;for(b=Math.min(c,a.length);;)if(d=
a.slice(0,b).toLowerCase().length,d<c)++b;else if(d>c)--b;else return b}var f=a.Pos;p.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(a){function b(a){a=f(a,0);return c.pos={from:a,to:a},c.atOccurrence=!1,!1}for(var c=this,d=this.doc.clipPos(a?this.pos.from:this.pos.to),m;;){if(this.pos=this.matches(a,d))return this.atOccurrence=!0,this.pos.match||!0;if(a){if(!d.line)return b(0);d=f(d.line-1,this.doc.getLine(d.line-1).length)}else{if(m=
this.doc.lineCount(),d.line==m-1)return b(m);d=f(d.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(e,b){if(this.atOccurrence){var c=a.splitLines(e);this.doc.replaceRange(c,this.pos.from,this.pos.to,b);this.pos.to=f(this.pos.from.line+c.length-1,c[c.length-1].length+(1==c.length?this.pos.from.ch:0))}}};a.defineExtension("getSearchCursor",function(a,b,c){return new p(this.doc,a,b,c)});a.defineDocExtension("getSearchCursor",
function(a,b,c){return new p(this,a,b,c)});a.defineExtension("selectMatches",function(e,b){for(var c=[],d=this.getSearchCursor(e,this.getCursor("from"),b);d.findNext()&&!(0<a.cmpPos(d.to(),this.getCursor("to")));)c.push({anchor:d.from(),head:d.to()});c.length&&this.setSelections(c,0)})});